<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Skill Gap Analysis - Skill Vistaar</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='webpages.css') }}">
</head>
<body>
  <header class="navbar">
    <button class="menu-icon" onclick="openSidebar()">☰</button>
    <a class="logo" href="{{ url_for('home') }}">SKILL VISTAAR</a>
  </header>

  <nav id="sidebar" class="sidebar">
    <button class="close-btn" onclick="closeSidebar()">✕</button>
    <a href="{{ url_for('career_guidance') }}">Personalized Career Guidance</a>
    <a href="{{ url_for('skill_gap') }}">Skill Gap Analysis</a>
    <a href="{{ url_for('salary_forecasting') }}">Salary Forecasting</a>
    <a href="{{ url_for('mentorship') }}">Mentorship Program</a>
    <a href="{{ url_for('networking') }}">Networking Opportunities</a>
  </nav>

  <main class="page-container" style="padding-bottom:40px;">
    <div class="network-card skillcard" style="max-width:1000px; margin:30px auto 22px auto;">

      <!-- Title inside the container -->
      <div class="skillcard-header">
        <h1 class="skill-title">Skill Gap Analysis</h1>
        <p class="skill-sub">Enter your target company (optional), the role you want, and your current skills (comma separated). The AI will analyze required skills, list missing skills, and give prioritized recommendations.</p>
      </div>

      <form id="skill-form" autocomplete="off" class="skill-form">
        <div class="form-grid" style="grid-template-columns: 1fr; gap: 14px;">

          <div class="field">
            <label for="company">Target Company (optional)</label>
            <input id="company" name="company" type="text" placeholder="e.g. Google" />
            <div class="error" data-for="company"></div>
          </div>

          <div class="field">
            <label for="position">Position / Role</label>
            <input id="position" name="position" type="text" placeholder="e.g. Software Engineer" required />
            <div class="error" data-for="position"></div>
          </div>

          <div class="field">
            <label for="skills">Your Current Skills (comma separated)</label>
            <textarea id="skills" name="skills" rows="4" placeholder="e.g. Python, Git, SQL" required></textarea>
            <div class="error" data-for="skills"></div>
          </div>
        </div>

        <div style="margin-top:16px; display:flex; gap:12px;">
          <button type="submit" class="btn primary-btn">Analyze</button>
          <button type="button" id="resetBtn" class="btn secondary-btn">Reset</button>
        </div>
      </form>
    </div>

    <!-- Result card -->
    <div id="result" class="network-card" style="max-width:1000px; margin:10px auto; display:none;">
      <h2 id="result-title">Skill gap analysis</h2>

      <div id="required" style="margin:10px 0;"></div>

      <div id="missing" style="margin:10px 0;"></div>

      <div id="recommendations" style="margin:10px 0;"></div>

      <div id="notes" style="margin-top:10px; color:#294766;"></div>
    </div>

  </main>

  <footer class="footer-gradient"><p>© 2025 Skill Vistaar</p></footer>

<script>
  const form = document.getElementById('skill-form');
  const resetBtn = document.getElementById('resetBtn');
  const resultCard = document.getElementById('result');
  const requiredEl = document.getElementById('required');
  const missingEl = document.getElementById('missing');
  const recEl = document.getElementById('recommendations');
  const notesEl = document.getElementById('notes');
  const titleEl = document.getElementById('result-title');

  function showError(field, msg) {
    const el = document.querySelector('.error[data-for="'+field+'"]');
    if (el) el.textContent = msg;
  }
  function clearErrors() {
    document.querySelectorAll('.error').forEach(e=>e.textContent='');
  }

  resetBtn.addEventListener('click', () => {
    form.reset();
    clearErrors();
    resultCard.style.display = 'none';
  });

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    clearErrors();
    const company = document.getElementById('company').value.trim();
    const position = document.getElementById('position').value.trim();
    const skills = document.getElementById('skills').value.trim();

    if (!position) {
      showError('position', 'Please enter a role.');
      return;
    }
    if (!skills) {
      showError('skills', 'Please list your current skills.');
      return;
    }

    // show loading
    titleEl.textContent = 'Analyzing...';
    requiredEl.innerHTML = '';
    missingEl.innerHTML = '';
    recEl.innerHTML = '';
    notesEl.innerHTML = '';
    resultCard.style.display = 'block';

    const payload = { company, position, skills };
    try {
      const res = await fetch('{{ url_for("analyze_skill_gap_api") }}', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify(payload)
      });
      if (!res.ok) {
        const t = await res.text();
        throw new Error(t || 'Server error');
      }
      const json = await res.json();
      if (json.error) throw new Error(json.error);

      titleEl.textContent = json.title || `Skill gap analysis for ${position}`;

      // Required (list)
      if (json.required && Array.isArray(json.required)) {
        requiredEl.innerHTML = '<strong>Required skills:</strong><ul>' +
          json.required.map(s => `<li>${s}</li>`).join('') + '</ul>';
      }

      // Missing (list)
      if (json.missing && Array.isArray(json.missing)) {
        missingEl.innerHTML = '<strong>Missing skills:</strong><ul>' +
          json.missing.map(s => `<li>${s}</li>`).join('') + '</ul>';
      }

      // Recommendations (list or text)
      if (json.recommendations) {
        if (Array.isArray(json.recommendations)) {
          recEl.innerHTML = '<strong>Recommendations:</strong><ol>' +
            json.recommendations.map(r => `<li>${r}</li>`).join('') + '</ol>';
        } else {
          recEl.innerHTML = '<strong>Recommendations:</strong><p>' + json.recommendations + '</p>';
        }
      }

      if (json.notes) {
        notesEl.textContent = json.notes;
      }

      window.scrollTo({top: resultCard.offsetTop - 40, behavior: 'smooth'});
    } catch (err) {
      titleEl.textContent = 'Error';
      recEl.innerHTML = `<p style="color:#b82b2b">${err.message}</p>`;
    }
  });
</script>

</body>
</html>
