<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Salary Forecasting</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='webpages.css') }}">
    <style>
        .page-wrap {
            display: flex;
            gap: 30px;
            max-width: 1100px;
            margin: 40px auto;
            padding: 20px;
            box-sizing: border-box;
        }
        .form-card, .result-card {
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.07);
            padding: 26px;
            flex: 1;
        }
        .form-card h2, .result-card h2 {
            margin-top: 0;
            color: #1A3A6C;
        }
        label {
            display: block;
            margin: 12px 0 6px;
            color: #1A3A6C;
            font-weight: 600;
        }
        input[type="text"], input[type="number"], textarea {
            width: 100%;
            padding: 10px 12px;
            border-radius: 6px;
            border: 1px solid #ddd;
            box-sizing: border-box;
        }
        textarea { min-height: 100px; }
        button.primary {
            background: #00A859;
            color: white;
            border: none;
            padding: 12px 18px;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 12px;
        }
        .small-muted { color: #666; font-size: 0.9rem; margin-top: 6px; }
        .result-list { list-style: none; padding-left: 0; }
        .result-list li { margin: 8px 0; font-size: 1rem; color: #1A3A6C; }
        .hidden { display: none; }
        .loader { display:inline-block; width:14px; height:14px; border:2px solid rgba(0,0,0,0.15); border-left-color:#00A859; border-radius:50%; animation:spin .8s linear infinite; vertical-align: middle; margin-left:8px;}
        @keyframes spin { to { transform: rotate(360deg); } }
        @media (max-width: 900px) {
            .page-wrap { flex-direction: column; padding: 10px; }
        }
    </style>
</head>
<body>
    <header>
        <nav class="navbar">
            <span class="menu-icon" onclick="openSidebar()">&#9776;</span>
            <a href="{{ url_for('home') }}" class="logo">SKILL VISTAAR</a>
        </nav>
    </header>

    <div id="sidebar" class="sidebar">
        <a href="javascript:void(0)" class="close-btn" onclick="closeSidebar()">⮿</a>
        <a href="{{ url_for('career_guidance') }}">Personalized Career Guidance</a>
        <a href="{{ url_for('skill_gap') }}">Skill Gap Analysis</a>
        <a href="{{ url_for('salary_forecasting') }}">Salary Forecasting</a>
        <a href="{{ url_for('mentorship') }}">Mentorship Program</a>
        <a href="{{ url_for('networking') }}">Networking Opportunities</a>
    </div>

    <main>
        <div class="page-wrap">
            <div class="form-card">
                <h2>Salary Forecasting</h2>

                <form id="salaryForm">
                    <label for="job">Job Title</label>
                    <input id="job" name="job" type="text" placeholder="e.g. Software Engineer" required>

                    <label for="location">Location</label>
                    <input id="location" name="location" type="text" placeholder="e.g. Bangalore">

                    <label for="experience">Years of Experience</label>
                    <input id="experience" name="experience" type="number" min="0" step="0.5" placeholder="e.g. 2">

                    <label for="skills">Current Skills (comma separated)</label>
                    <textarea id="skills" name="skills" placeholder="e.g. python, git, sql"></textarea>

                    <button type="submit" class="primary">Get Salary Forecast <span id="spinner" class="hidden loader"></span></button>
                </form>
                <p id="form-note" class="small-muted">Tip: use role names like "Software Engineer", "Data Scientist", "Web Developer".</p>
            </div>

            <div id="resultCard" class="result-card hidden">
                <h2>Forecast Result</h2>
                <div id="resultContent">
                    <!-- result injected here -->
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="footer-gradient"></div>
        <p>&copy; 2025 Skill Vistaar</p>
    </footer>

    <script>
        function openSidebar(){ document.getElementById("sidebar").style.width = "250px"; }
        function closeSidebar(){ document.getElementById("sidebar").style.width = "0"; }

        const form = document.getElementById('salaryForm');
        const resultCard = document.getElementById('resultCard');
        const resultContent = document.getElementById('resultContent');
        const spinner = document.getElementById('spinner');

        form.addEventListener('submit', async function(e){
            e.preventDefault();
            resultCard.classList.add('hidden');
            resultContent.innerHTML = '';
            spinner.classList.remove('hidden');

            const payload = {
                job: form.job.value.trim(),
                location: form.location.value.trim(),
                experience: form.experience.value.trim(),
                skills: form.skills.value.trim()
            };

            try {
                const res = await fetch('/predict_salary', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(payload)
                });
                if(!res.ok) throw new Error('Server returned ' + res.status);
                const data = await res.json();

                const html = `
                    <p class="small-muted">Role: <strong>${payload.job || '—'}</strong> &nbsp; Location: <strong>${payload.location || '—'}</strong> &nbsp; Experience: <strong>${payload.experience || 0} yrs</strong></p>
                    <ul class="result-list">
                        <li><strong>Minimum salary:</strong> ₹${data.min.toLocaleString()}</li>
                        <li><strong>Average salary:</strong> ₹${data.avg.toLocaleString()}</li>
                        <li><strong>Maximum salary:</strong> ₹${data.max.toLocaleString()}</li>
                    </ul>
                    <h4>Skills to learn to boost salary</h4>
                    <ul>${data.missing_skills && data.missing_skills.length ? data.missing_skills.map(s => `<li>${s}</li>`).join('') : '<li>None — you already have core boost skills</li>'}</ul>
                    <p class="small-muted">${data.note || ''}</p>
                `;
                resultContent.innerHTML = html;
                resultCard.classList.remove('hidden');
            } catch (err) {
                resultContent.innerHTML = `<p style="color:red">Error: ${err.message}</p>`;
                resultCard.classList.remove('hidden');
            } finally {
                spinner.classList.add('hidden');
            }
        });
    </script>
</body>
</html>
