<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Salary Forecasting - Skill Vistaar</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='webpages.css') }}">
</head>
<body>
  <header class="navbar">
    <button class="menu-icon" onclick="openSidebar()">☰</button>
    <a class="logo" href="{{ url_for('home') }}">SKILL VISTAAR</a>
  </header>

  <nav id="sidebar" class="sidebar">
    <button class="close-btn" onclick="closeSidebar()">✕</button>
    <a href="{{ url_for('career_guidance') }}">Personalized Career Guidance</a>
    <a href="{{ url_for('skill_gap') }}">Skill Gap Analysis</a>
    <a href="{{ url_for('salary_forecasting') }}">Salary Forecasting</a>
    <a href="{{ url_for('mentorship') }}">Mentorship Program</a>
    <a href="{{ url_for('networking') }}">Networking Opportunities</a>
  </nav>

  <main class="content form-page">
    <h1>Salary Forecasting</h1>
    <form id="salaryForm" class="form-card">
      <label>Job Title</label>
      <input name="job" type="text" required placeholder="e.g. Software Engineer">

      <label>Location</label>
      <input name="location" type="text" required placeholder="e.g. Bangalore">

      <label>Years of Experience</label>
      <input name="experience" type="number" min="0" required placeholder="e.g. 2">

      <label>Current Skills (comma separated)</label>
      <textarea name="skills" rows="3" placeholder="python, data structures"></textarea>

      <button type="submit" class="btn">Get Salary Forecast</button>
    </form>

    <div id="salary-result" class="result-card" style="display:none"></div>
  </main>

  <footer class="footer-gradient"><p>© 2025 Skill Vistaar</p></footer>

  <script src="{{ url_for('static', filename='script.js') }}"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const form = document.getElementById('salaryForm');
      const resultDiv = document.getElementById('salary-result');

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        resultDiv.style.display = 'block';
        resultDiv.innerHTML = '<em>Processing…</em>';

        const formData = new FormData(form);
        const payload = {
          job: formData.get('job') || "",
          location: formData.get('location') || "",
          experience: formData.get('experience') || "",
          skills: formData.get('skills') || ""
        };

        try {
          const res = await fetch('/forecast_salary', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(payload)
          });
          const data = await res.json();
          if (data.error) {
            resultDiv.innerHTML = `<p class="error">${data.error}</p>`;
            return;
          }
          const min = Number(data.min_salary || 0).toLocaleString('en-IN');
          const avg = Number(data.avg_salary || 0).toLocaleString('en-IN');
          const max = Number(data.max_salary || 0).toLocaleString('en-IN');

          resultDiv.innerHTML = `
            <h3>Salary Forecast</h3>
            <ul>
              <li><strong>Min:</strong> ₹${min}</li>
              <li><strong>Avg:</strong> ₹${avg}</li>
              <li><strong>Max:</strong> ₹${max}</li>
            </ul>
            <h4>Skills to Boost Salary</h4>
            <ul>${(data.recommended_skills || []).map(s => `<li>${s}</li>`).join('')}</ul>
            <p>${data.explanation || ""}</p>
          `;
        } catch (err) {
          resultDiv.innerHTML = `<p class="error">Request failed: ${err}</p>`;
        }
      });
    });
  </script>
</body>
</html>
